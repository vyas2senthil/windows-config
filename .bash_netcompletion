#!/bin/bash
_ping() {
        local HOST_LIST

        COMPREPLY=()
        cur=${COMP_WORDS[COMP_CWORD]}

        # I'm going to ignore IPv6 hosts for now, hence the '::'
        HOST_LIST="$( echo $( grep -Ev '^$|^#|::' /etc/hosts ) )"

        COMPREPLY=( $( compgen -W "$HOST_LIST" -- "$cur" ) )
        return 0
}
complete -F _ping ping
complete -F _ping fping
complete -F _ping telnet
complete -F _ping ssh
complete -F _ping slin

_repo-switch() {
    local br_list
    COMPREPLY=()
    cur=${COMP_WORDS[COMP_CWORD]}
    
    br_list=$( cd `lookup_file .repo/manifests` >/dev/null 2>&1; git branch -r |perl -npe 's,.*/,,')
    COMPREPLY=( $( compgen -W "$br_list" -- "$cur" ) )
    return 0
}

_remote_branches() {
    local br_list
    COMPREPLY=()
    cur=${COMP_WORDS[COMP_CWORD]}
    
    br_list=$( git branch -r |perl -npe 's,.*/,,')
    COMPREPLY=( $( compgen -W "$br_list" -- "$cur" ) )
    return 0
}

_git_tags() {
    local br_list
    COMPREPLY=()
    cur=${COMP_WORDS[COMP_CWORD]}
    
    br_list=$( git tag)
    COMPREPLY=( $( compgen -W "$br_list" -- "$cur" ) )
    return 0
}
    
complete -F _repo-switch repo-switch
complete -F _remote_branches git-track
complete -F _git_tags git-track-tag

_mail() {
    COMPREPLY=()
    cur=${COMP_WORDS[COMP_CWORD]}
    prev=${COMP_WORDS[COMP_CWORD-1]}

    if [[ $prev == '-a' ]]
    then
        return 0
    fi
    
    cd ~/.mail.addr

    

    

    local IFS=$'\n'


    COMPREPLY=( $( compgen -A file -- $cur ) )
    cd - >/dev/null


    return 0
}

complete -F _mail -o default -o filenames mail
complete -F _mail -o default -o filenames motds.sh
