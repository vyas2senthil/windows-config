#!/bin/bash
export PROMPT_COMMAND="history -a"

if test -z "$SSH_CLIENT"; then
    export PS1='\n[01;34m{ [01;31m'`whoami`'[01;34m@[01;33m'`hostname`'[01;34m [01;32m'\$PWD'[01;34m }[0m\n$'
else
    export LOCALIP=`echo $SSH_CONNECTION|awk '{print $3}'|sed -e 's/.*://'`
    export LOCALPORT=`echo $SSH_CONNECTION|awk '{print $4}'`
    export WHOAMI=`whoami`
    export REMOTEIP=`echo ${SSH_CLIENT} | awk '{print $1}'|perl -npe 's/.*://'`
    export DISPLAY=$REMOTEIP:0.0
    export PS1HostName=`hostname`
    export PS1='\n( \u@$PS1HostName [01;32m| \w |[0m [01;34mRemote[01;31m:[01;34mTrue[0m)\n\$'
    #!/bin/bash

    function edit()
    {
        if [[ $WHOAMI == root ]] && [[ -f "$1" ]]; then
            echo using root to do edit, won\'t check read permission
        else
            if ! [[ -r "$1" ]]; then
                echo Error: "$1" is not readable
                return 1
            fi
            if ! [[ -w "$1" ]]; then
                echo Warning: "$1" is not writable
            fi
        fi    
        local IFS=$'\n'
        local file=$( readlink -f "$1" )
        local dir=$( dirname "$file" )
        file=$( basename "$file")
        (
            cd "$dir" >/dev/null 2>&1
            ssh $REMOTEIP /qq/bin/windows/rsshedit.sh -n \""/scp:$WHOAMI@$LOCALIP:/`pwd`/$file"\"
            cd - >/dev/null 2>&1
        )
    }

    alias sudoedit='WHOAMI=root edit'

fi

