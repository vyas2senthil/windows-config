#!/bin/bash
apt-get()
{
    if test "$1" = source; then
        command apt-get "$@";
    else
        sudo apt-get "$@"
    fi
}

for x in host traceroute telnet
do 
    eval "function $x()
    {
        if test \$# = 1; then
            local h=\`echo \"\$1\"|perl -npe 's!.*//(.*?)/.*!\$1!'\`
            command $x \$h
        else
            command $x "\$@"
        fi
    }"
done
. `which wp`

function renew-xauth() {
    if test -z "$SSH_CLIENT"; then
        . ~/.new-xauth
    else
        if test `ps -o comm=  -o pid= -A|grep gnome-terminal|wc -l` != 1; then
            echo 'you have more that 1 gnome-terminal running, can not renew xauth!'
            return 1
        fi
        export $(cat /proc/`ps -o comm=  -o pid= -A|grep gnome-terminal|pn 2`/environ|perl -npe 's/\x00/\n/g'|grep '^DISPLAY=')
        export $(cat /proc/`ps -o comm=  -o pid= -A|grep gnome-terminal|pn 2`/environ|perl -npe 's/\x00/\n/g'|grep '^REMOTEIP=')
    fi
}

for x in ~/.bash_completion.d/*; do 
    . "$x"
done

function _select_cd() {

    local IFS=$'\n'
    local dirs=( 
	"$@"
    )

    if test ${#dirs[@]} = 0; then
        echo 'Error: no such file or directory'
        return 1
    elif test ${#dirs[@]} = 1; then
        builtin cd ${dirs[0]}
    else 
        NUM=`my_select "${dirs[@]}"`
        ((NUM--))
        builtin cd "${dirs[$NUM]}"
        cd_record
        if test $# = 1; then
            history -s cd "$(printf %q "$1")"
        else
            history -s cd "$@"
        fi
    fi
}

function tcd() {
    local IFS=$'\n'
    _select_cd $(lookup_file `today "$@"`; lookup_file `today-- "$@"`) $(pcd ~/today && { lookup_file `today "$@"`;  lookup_file `today-- "$@"`; })
}

function mcd() {
    local IFS=$'\n'
    _select_cd $(lookup_file "$@")
}

function rdesktop() {
    command rdesktop -K -g $(xrandr |grep '\*'|pn 1) $1 -u ${2:-$USER} -p ${3:-123456}
}
