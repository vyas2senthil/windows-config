#!/bin/bash
apt-get()
{
    if test "$1" = source; then
        command apt-get "$@";
    else
        sudo apt-get "$@"
    fi
}

for x in host traceroute telnet
do 
    eval "function $x()
    {
        if test \$# = 1; then
            local h=\`echo \"\$1\"|perl -npe 's!.*//(.*?)/.*!\$1!'\`
            command $x \$h
        else
            command $x "\$@"
        fi
    }"
done
. ~/bin/wp

function renew-xauth() { # so that in the saved gnu screen session, I can reset the xauth
    if test -z "$SSH_CLIENT"; then
        . ~/.new-xauth
    else
        if test `ps -o comm=  -o pid= -A|grep gnome-terminal|wc -l` != 1; then
            echo 'you have more that 1 gnome-terminal running, can not renew xauth!'
            return 1
        fi
        export $(cat /proc/`ps -o comm=  -o pid= -A|grep gnome-terminal|pn 2`/environ|perl -npe 's/\x00/\n/g'|grep '^DISPLAY=')
        export $(cat /proc/`ps -o comm=  -o pid= -A|grep gnome-terminal|pn 2`/environ|perl -npe 's/\x00/\n/g'|grep '^REMOTEIP=')
    fi
}

function adb() {
    if test "$1" = -w; then
        command adb wait-for-device
        shift
    fi
    if test "$1" = -s; then
        echo "$2" > ~/.adbd
    elif test "$1" != devices -a $(setsid adb start-server >/dev/null 2>&1 ; command adb devices | grep .| wc -l) -gt 2; then
        set -- -s "$(cat ~/.adbd)" "$@"
    fi

    if test $# -lt 1 -a $1 = shell; then
        command adb "$@" | tr -d '\r'
    else
        command adb "$@"
    fi
}

if test -e ~/.logs/sudo-ssh; then

    function sudo {
        command=$(
            echo 'true; true;'
            printf "cd %q\n%q" "$PWD" "$1"
            shift
            for x in "$@"; do
                printf " %q" "$x"
            done
            echo
        )
        ssh root@localhost bash -c "$command"
    }

else
    function sudo {
        command sudo env PATH=$PATH "$@"
    }
fi
export -f sudo
