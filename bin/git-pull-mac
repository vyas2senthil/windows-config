#!/bin/bash

set -ex
crontab -l > ~/.crontab.tmp
user_cron=true
diff ~/.crontab.tmp ~/.crontab && user_cron=false
test $PWD = ~ && cd ~/windows-config/
(cd $(lookup_file .git) && rm refs/remotes/origin/from-mac -rf)
git fetch origin
for x in $(git branch -a |grep 'remotes.*from-mac'|grep -v origin-w); do
    remote=$(echo $x|awk -F/ '{print $2}')
    branch=$(echo $x|perl -npe 's/.*?from-mac/from-mac/')
    git pull $remote $branch
done
test $user_cron = false && { diff ~/.crontab.tmp ~/.crontab || crontab ~/.crontab; }
git submodule init
git submodule update
