#!/bin/bash

set -e

function die() {
    echo Error: "$@"
    exit -1
}

if test $# = 0; then
    for x in ~/.logs/start-debug.log/*; do
        test -e "$x" && stop-debug $(basename $x)
    done
    exit
fi

if test "$(which $1)" != $(readlink -f ~/bin/linux/ext/debug/$(basename $1)); then
   die "stop debug can only act on commands under ~/bin/linux/ext/debug/"
fi

if ! grep -q 'start-debug' ~/bin/linux/ext/debug/$(basename $1); then
    die "stop debug can only act on commands created by start-debug"
fi

rm ~/bin/linux/ext/debug/$(basename $1)
rm ~/.logs/start-debug.log/$(basename $1) -rf
