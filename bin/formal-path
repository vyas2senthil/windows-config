#!/bin/bash

source=$1
source=$(echo "$source"|perl -npe 's,/+,/,g')
source=$(lookup_file "$source")

while [[ "$source" =~ /./ ]]; do
    source=$(echo "$source" | perl -npe 's,/\./,/,g')
done

while [[ "$source" =~ /../ ]]; do
    source=$(echo "$source" | perl -npe 's,(^|(?!\.\./)[^/]+)/\.\./,/,g')
done

echo "$source"
