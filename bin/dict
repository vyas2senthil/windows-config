#!/bin/bash

set -x -e
set -- "$(perl -e 'print lc $ARGV[0]' "$1")"
cd /home/bhj/tmp/stardict-babylon-AHD4_2.8-2.4.2.tar.bz2.unzip.1574/stardict-babylon-AHD4_2.8-2.4.2
cd $(echo -n "$1"|md5sum|cut -b 1-3|perl -npe 's,(.),$1/,g')

export target=$1
find . -type f|xargs -d \\n bash -x -c 'for x in "$@"; do x=${x:2}; if test "$(perl -e "print lc \$ARGV[0]" "$x")" = "$target"; then
cat "$x" | perl -npe "s#\036#../../../res/#g; s#\037##g" > "$x".bak
mv "$x".bak "$x"
firefox "$x"
fi;
done' true
