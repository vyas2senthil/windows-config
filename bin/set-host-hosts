#!/usr/bin/env perl
BEGIN 
{
    open($file, "<", "/etc/hosts");
    while (<$file>) {
        next if m/^\s*#/;
        next if m/^\s*$/;
        @line = split;
        $ip = shift @line;
        for (@line) {
            $hosts{$_} = $ip;
        }
    }
}

$host = $ARGV[0];
$ip = $ARGV[1];

$hosts{$host} = $ip;

open($file, ">", "/etc/hosts") or die "Error: can not open /etc/hosts, are you root?";

for (sort keys %hosts) {
    $ip = $hosts{$_};
    print $file "$ip $_\n";
    print "$ip $_\n";
}
