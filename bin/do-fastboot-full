#!/bin/bash

# part   0::attr 0::         tim  start 0x00000000, size 0x00040000
# part   1::attr 0::         obm  start 0x00040000, size 0x00040000
# part   2::attr 0::       uboot  start 0x00080000, size 0x00080000
# part   3::attr 0::     ramdisk  start 0x00100000, size 0x00040000
# part   4::attr 0::        imei  start 0x00140000, size 0x00040000
# part   5::attr 0:: arbelbinary  start 0x00180000, size 0x00700000
# part   6::attr 0::   msabinary  start 0x00880000, size 0x00100000
# part   7::attr 0::      kernel  start 0x00980000, size 0x00400000
# part   8::attr 0:: maintenance  start 0x00d80000, size 0x00400000
# part   9::attr 0::    recovery  start 0x01180000, size 0x00500000
# part  10::attr 0::        misc  start 0x01680000, size 0x00040000
# part  11::attr 1::       cache  start 0x016c0000, size 0x05140000
# part  12::attr 1::      system  start 0x06800000, size 0x0a000000
# part  13::attr 1::    userdata  start 0x10800000, size 0x0d800000
# part  14::attr 0::        logo  start 0x1e000000, size 0x00340000
# part  15::attr 0::         env  start 0x1e340000, size 0x00080000
# part  16::attr 0::      kpanic  start 0x1e3c0000, size 0x00040000
# part  17::attr 0::         nvm  start 0x1e400000, size 0x00800000
# part  18::attr 1::   telephony  start 0x1ec00000, size 0x00800000
# part  19::attr 0::    reserved  start 0x1f400000, size 0x00c00000

set -e
cd $(lookup_file flashing)

function do-partition() {
    fastboot erase $1;
    if test $1 = system; then
	fastboot oem onfly system;
    fi
    fastboot flash $1 ${2:-$1.img}
}


# tim               =                                       , start:        0B, size:      256K, end:        0B
# obm               =                                       , start:      256K, size:      256K, end:        0B
# uboot             =                                       , start:      512K, size:      512K, end:        0B
# ramdisk           =                                       , start:        1M, size:      256K, end:        0B
do-partition ramdisk
# imei              =                                       , start:    1M256K, size:      256K, end:        0B
# arbelbinary       =                                       , start:    1M512K, size:        7M, end:        0B
do-partition arbelbinary Arbel_DIGRF3.bin
# msabinary         =                                       , start:    8M512K, size:        1M, end:        0B
do-partition msabinary TTC1_M05_AI_A1_Flash.bin
# kernel            =                                       , start:    9M512K, size:        4M, end:        0B
do-partition kernel uImage
# maintenance       =                                       , start:   13M512K, size:        4M, end:        0B
do-partition maintenance uImage-mt
# recovery          =                                       , start:   17M512K, size:        5M, end:        0B
do-partition recovery ramdisk-recovery.img
# misc              =                                       , start:   22M512K, size:      256K, end:        0B
fastboot erase misc
# cache             =                                       , start:   22M768K, size:   81M256K, end:        0B
fastboot erase cache
# system            =                                       , start:      104M, size:      160M, end:        0B
do-partition system
# userdata          =                                       , start:      264M, size:      216M, end:        0B
do-partition userdata
# logo              =                                       , start:      480M, size:    3M256K, end:        0B
do-partition logo logo.bin
# env               =                                       , start:  483M256K, size:      512K, end:        0B
# kpanic            =                                       , start:  483M768K, size:      256K, end:        0B
# nvm               =                                       , start:      484M, size:        8M, end:        0B
fastboot erase nvm
# telephony         =                                       , start:      492M, size:        8M, end:        0B
do-partition telephony pxafs.img
# reserved          =                                       , start:      500M, size:       12M, end:        0B
read -p "Press enter to restart fastboot "
fastboot reboot
