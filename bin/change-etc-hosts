#!/bin/bash

host=$1
ip=$2

function die() {
    echo "$@"
    exit -1
}

match=$(grep -P '^(\d+\.){3}\d+\s+\b\Q'$host'\E\b$' /etc/hosts | wc -l)

if (( match >= 2 )); then
   die "Error: more than one match for $host"
fi

if ((match == 1)); then
    sudo perl -npe 's/^(\d+\.){3}\d+\s+\b\Q'$host'\E\b$/'$ip' '$host'/' -i /etc/hosts
else
    sudo bash -c "echo $ip $host >> /etc/hosts"
fi
