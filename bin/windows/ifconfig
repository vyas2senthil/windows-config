#!/bin/bash

adapter_name_matcher='wlan0|eth0'
if test "${1:0:1}" != /; then
    adapter_name_matcher=${1:-wlan0|eth0} #empty matches all adapters
    shift
fi

ipconfig "$@" | tr -d '\r' |grep -v v6 -i | perl -ne '
if (m/^\S.*:$/) {
    print $to_print if $to_print;
    if (m/'"$adapter_name_matcher"'/) {
        $to_print = $_;
    } else {
        $to_print = "";
    }
} else {
    $to_print .= $_ if $to_print;
}
' | perl -npe 's/\(Preferred\)//'
