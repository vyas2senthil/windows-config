#!/bin/bash

unset dswSlnFile
for x in *.sln ../*.sln ../../*.sln ../../../*.sln; do 
    if [[ -f "$x" ]]; then
        dswSlnFile="$x"
        break
    fi
done

if [[ -z $dswSlnFile ]]; then
    for x in *.dsw ../*.dsw ../../*.dsw ../../../*.dsw; do 
        if [[ -f "$x" ]]; then
            dswSlnFile="$x"
            break
        fi
    done
fi

if [[ -z $dswSlnFile ]]; then
    echo "Error: no project file (*.sln|*.dsw) found anywhere!"
    exit -1
fi

cd "`dirname \"$dswSlnFile\"`"
dswSlnFile="`basename \"$dswSlnFile\"`"



case $dswSlnFile in 
    *.dsw)
        vc6compile "$@" || exit
        ;;
    *.sln)
        if grep "Format Version 9.00" $dswSlnFile;
        then
            vc8compile.py $dswSlnFile "$@" || exit
        else
            vc7compile "$@"
        fi
        ;;
esac 
