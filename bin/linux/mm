#!/bin/bash

time (
    set -e
    set -o pipefail
    build_env=`lookup_file build/envsetup.sh`
    top_dir=`dirname $build_env`
    top_dir=`readlink -f $top_dir/..`

    cd $top_dir/
    . build/envsetup.sh
    set_stuff_for_environment
    cd - 

    cd "$(dirname `lookup_file Android.mk`)"
    mm "$@" files 2>&1|
    grep -v '^Copy: .*/target/product/.*/system/media/audi'|
    grep -v -e '/lang_pico/\|libinputcore-2.so\|libkpencore.so\|libqpicjni6.so\|/root/initlogo.rle\|/system/app/BaiduIme_v2.1.1.6.apk\|/system/app/android_10503_20111014.apk\|/system/app/cn.goapk.market_v2.1.4.apk\|/system/app/com.alensw.picfolder_v1.4.2.apk\|/system/etc/apns-conf.xml\|/system/etc/permissions/com.tmobile.software.themes.xml\|/system/etc/repository.txt'|
    perl -ne 'print unless /unmappable character for encoding ascii/'

    echo OK
)
