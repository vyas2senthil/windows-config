#!/usr/bin/env perl

use strict;
use Getopt::Long;

sub uniq {
    my %uniq;
    my @uniq;
    for (@_) {
        next if $uniq{$_};
        $uniq{$_} = 1;
        push @uniq, $_;
    }
    return @uniq;
}

if (grep(m/^--help$/, @ARGV)) {
    system("confluence-help.pl", uniq(@ARGV));
    exit 0;
}

my $remove_colon = 0;
for (@ARGV) {
    if ($_ eq "--assignee" or $_ eq "--issue") {
        $remove_colon = 1;
        next;
    }
    if ($remove_colon == 1) {
        $_ =~ s/:.*//;
        $remove_colon = 0;
        next;
    }
}

my $confserv=`cat ~/.confserv`;
my $confuser=`cat ~/.confuser`;
chomp($confserv);
chomp($confuser);

my $space = "~$confuser";

GetOptions(
    "space=s" => \$space,
    );    

system("confluence.sh", "--server", "http://$confserv", "--user", $confuser, "--password", `get-authinfo $confserv|tr -d '\n'`, "--space", $space, @ARGV);
