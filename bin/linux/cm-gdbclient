#!/bin/bash
set -- `readlink -f "$1" ` $2
OUT_ROOT=/tmp
if ! test -e "$1/system/bin/$2" -a -e "$1"/buildspec.mk; then
    . build/envsetup.sh
    set -- $(get_abs_build_var TARGET_OUT_EXECUTABLES_UNSTRIPPED)/../.. $2
fi
OUT_SYMBOLS="$1"
OUT_SO_SYMBOLS="$1"/system/lib
PORT=:5039
adb forward tcp:5039 tcp:5039
echo >|"$OUT_ROOT/gdbclient.cmds" "set solib-absolute-prefix $OUT_SYMBOLS"
echo >>"$OUT_ROOT/gdbclient.cmds" "set solib-search-path $OUT_SO_SYMBOLS"
echo >>"$OUT_ROOT/gdbclient.cmds" "target remote $PORT"
echo >>"$OUT_ROOT/gdbclient.cmds" ""

arm-eabi-gdb -x "$OUT_ROOT/gdbclient.cmds" "$1/system/bin/$2"

