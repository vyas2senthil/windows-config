#!/usr/bin/env perl

use Getopt::Long;
use strict;
use String::ShellQuote;

print "$0 ";
foreach my $x (@ARGV) {
    $x = shell_quote($x);
    print "$x ";
}
print "\n";


#gtags-cscope-grep regexp

my $pwd;


chomp($pwd = `pwd`);

$pwd = "$ENV{HOME}/tmp/for-code-reading$pwd";
our $approx_dir = $pwd;
while ( not -f "$pwd/GTAGS" and not "$pwd" eq "/") {
    chomp($pwd = `dirname "$pwd"`);
}
if ($pwd eq "/") {
    chomp($pwd = `readlink -f ~/.gtags-dir`)
}

$approx_dir = substr($approx_dir, length($pwd));

my $lookup_type = 1;
my $lookup_needle = "hello_world";
my $lookup_restrict_regexp;

GetOptions(
           "e=s" => \$lookup_needle,
          );

my $GTAGS_START_FILE = $ENV{"GTAGS_START_FILE"};

open(my $javaParserOut, "-|", "echo $GTAGS_START_FILE|gtagsAntlrJavaParserPrivateOk");

while(<$javaParserOut>) {
    #def com.letou.autotest 17 /home/bhj/src/theatre/rayzerlink-tools/LetouAutoTest/src/com/letou/autotest/Term.java package com.letou.autotest
    # 0    1                2    3                                                                                    4               5
    chomp;
    my @F = split;
    if ($lookup_needle eq $F[1]) {
        print $F[3] . ":" . $F[2] . ": " . $F[4] . " " . $F[5] . "\n";
    }
}
