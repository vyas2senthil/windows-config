#!/bin/bash
set -e

packages_dir=${PACKAGES_DIR:-~/bin/linux/config/pkgs/}
packages=$(find "$packages_dir" -type f|perl -npe 's,.*/,,')
if test "$USER" = bhj; then
    packages="$packages texlive-full"
fi

export LC_ALL=C
export LANG=C
while ! sudo apt-get install "$@" -y $packages; do
    packages=$(arg1-arg2 "$packages" "$(sudo apt-get install "$@" -y $packages 2>&1)");
    echo installing: $packages
done

~/bin/linux/config/install-missing-pkgs "$@"
cat /etc/tsocks.conf |grep -e '^server' > /tmp/tsock.conf

if diff ~/etc/tsock.conf /tmp/tsock.conf; then
    true;
else
    echo 'Warning! Your /etc/tsock.conf is not configured correctly!'
    read -p 'Press any key to continue... '
fi
