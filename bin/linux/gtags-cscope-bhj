#!/usr/bin/env perl

use Getopt::Long;
use strict;
use String::ShellQuote;


my $lookup_type = substr($ARGV[4], 1);
$_ = $ARGV[5];
(my $lookup_needle, my $lookup_restrict_regexp) = split;

open(my $grep, "-|", "echo $lookup_type$lookup_needle|gtags-cscope");
print "lookup_restrict_regexp is $lookup_restrict_regexp\n" if $lookup_restrict_regexp;

while (<$grep>) {
  chomp();
  s/^>>.*//;
  my $file=$_;
  $file =~ s/ .*//;
  if (not -e $file) {
    next;
  }
  if ($lookup_restrict_regexp && not m/$lookup_restrict_regexp/i) {
    next;
  }
  print "$_\n";
}
