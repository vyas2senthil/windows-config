#!/bin/bash

if test $# = 1; then
    set -- "$@" .
fi

args=("$@")
n_targets=$#
((n_targets--))

last_arg=${args[$#-1]}

function die() {
    echo "$@"
    exit -1
}

function calc_relative() {
    
if (($# > 2)) && test ! -d "$last_arg"; then
    die "ln: target \`Android.mk' is not a directory"
fi

test -f "$last_arg" && last_arg=$(dirname "$last_arg")

last_arg=$(readlink -f "last_arg")
test -e "$last_arg" || die "ln: target \`$last_arg does not exist"

for x in $(seq 1 $n_targets); do
    source=${args[$x-1]}
    source=$(echo "$source"|perl -npe 's,/+,/,g')

    source=$(lookup_file "$source")
    test -e "$source" || { echo "ln: source \`$source does not exist"; continue; }

    relative_source=$(calc_relative "$source" "last_arg")
    ln -s -- "$relative_source" "$last_arg"
done
    
